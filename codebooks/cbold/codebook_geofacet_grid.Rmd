---
title: "Codebook bundeslaendeR geofacet grid"
author: "Robert Stelzle"
date: "21.01.2022"
output:
  pdf_document:
    keep_tex: true
header-includes:
- \usepackage{longtable}
- \usepackage{float}
- \usepackage{graphicx}
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
---
  
```{r include=FALSE}
library(here)
library(tidyverse)
library(bundeslaendeR)
library(kableExtra)
library(patchwork)
library(geofacet)
library(sf)
library(ggrepel)
library(ggthemes)

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.align="center",
                      fig.width = 5)
```


## `de_states_grid_4x4()`

`de_states_grid_4x4()` exports a data frame containing state IDs, german and english state names and approximate state locations on a 4x4 grid.
The exported data frame can be used to approximately plot state-facets in their approximate locations using ggplot2 extension geofacet.

Please find a comparison of state locations and the grid layout below.

### Example Code:


```{r echo=TRUE, message=FALSE, warning=FALSE}
library(bundeslaendeR)
library(tidyverse)
library(geofacet)

turnout_plot <-
ltw_election_results %>% 
  select(state, election_date, turnout) %>% 
  distinct() %>% 
  filter(!(state %in% c("WB", "BA", "WH"))) %>% 
  filter(!is.na(turnout)) %>% 
  ggplot(aes(x = election_date, y = turnout)) +
    geom_line() +
    facet_geo(grid = de_states_geofacet_grid_4x4(linebreak = T),
              facets = ~state, label = "name") +
    scale_y_continuous(limits = c(0,1),
                       labels = scales::percent) +
    theme_minimal() +
    theme(strip.text = element_text(face = "bold")) +
    labs(x = NULL, y = "Turnout")
```





```{r message=FALSE, warning=FALSE, include=FALSE}

dir.create(here("codebooks", "sfdl"))
curl::curl_download("https://www.geoboundaries.org/data/1_3_3/zip/shapefile/DEU/DEU_ADM1.shp.zip",
                    here("codebooks", "sfdl", "germany.shp.zip"))
unzip(zipfile = here("codebooks", "sfdl", "germany.shp.zip"), exdir = here("codebooks", "sfdl"))

germany <- 
  st_read(here("codebooks", "sfdl", "DEU_ADM1.shp"))

unlink(here("codebooks", "sfdl"), recursive = T)


cents <-
germany %>% 
  st_make_valid() %>% 
  st_centroid() %>% 
  st_as_sf() %>%
  mutate(lat = unlist(map(.$geometry,1)),
         long = unlist(map(.$geometry,2)))


set.seed(123456)

leftplot <- 
germany %>% 
ggplot() +
    geom_sf() +
    geom_sf(data = cents) +
    geom_label_repel(data = cents,
                    aes(x = lat, y = long, label = NAME),
                    point.padding = 5) +
    theme_map()






```

\newpage

\blandscape


```{r, fig.cap="Comparison of state location and grid layout", fig.height=6, fig.width=10}
wrap_plots(leftplot, turnout_plot, nrow = 1)

```


\elandscape


